<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Style Transfer</title>
    <link rel="stylesheet" href="../css/theme.css">
    <link rel="stylesheet" href="../css/header.css">
</head>
<body>

<div id="header"></div>
<script type="text/javascript" src="../js/header.js"></script>

<div id="image" style="margin-top: 70px;">
    <div class="item">
        <p class="title"><b>风格迁移后的图像</b></p>
        <canvas id="diffStyleImage"></canvas>
    </div>
</div>

<script src="../js/opencv.js" type="text/javascript"></script>
<script type="text/javascript" src="../js/handleCookie.js"></script>
<script type="text/javascript">
    let imgSrc = getCookie('imgSrc');
    console.log(imgSrc);

    cv['onRuntimeInitialized'] = () => {
        var style_canvas = document.getElementById('diffStyleImage');
        var ctx = style_canvas.getContext('2d');

        var img = new Image();
        img.src = imgSrc;
        img.onload = function () {
            let img_width = img.width,
                img_height = img.height;
            let img_ratio = img_width / img_height; // 图片宽高比

            let cont_width,
                cont_height;
            if (window.outerHeight < window.outerWidth) {
                cont_height = window.outerHeight;
                cont_width = cont_height * img_ratio;
            } else {
                cont_width = window.outerWidth;
                cont_height = cont_width / img_ratio
            }


            img.width = cont_width;
            img.height = cont_height;

            let cont_left = 0,
                cont_top = 0;
            cont_left = (window.outerWidth - cont_width) / 2;

            style_canvas.width = cont_width;
            style_canvas.height = cont_height;
            style_canvas.left = cont_left;
            var items = document.getElementsByClassName('item');
            for (var i = 0; i < items.length; i++) {
                items[i].style.marginLeft = cont_left + 'px';
            }

            // 风格迁移
            let src = cv.imread(img);
            let gray = new cv.Mat();
            cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);

            let gray_blur = new cv.Mat();
            let ksize = new cv.Size(25, 25);
            cv.GaussianBlur(gray, gray_blur, ksize, 0, 0, cv.BORDER_DEFAULT);

            let cartoon = new cv.Mat();
            cv.divide(gray, gray_blur, cartoon, scale=250.0);

            cv.imshow("diffStyleImage", cartoon);
        };
    };
</script>

</body>
</html>